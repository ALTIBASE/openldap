SRCS=	main.c
XSRCS=	version.c
OBJS=	main.o
PROGRAMS= in.xfingerd
VINCLUDEDIR= -I../../include
VLIBDIR= ../../libraries
VLIBS= -L$(VLIBDIR)

in.xfingerd : version.o
	$(CC) $(LDFLAGS) -o $@ version.o $(OBJS) $(LIBS)

version.c: ${OBJS} ${LDAP_LIBDEPEND}
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	    t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	    -e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	    -e "s|%VERSION%|$${v}|" \
	    < $(srcdir)/Version.c > $@)

install: $(PROGRAMS) FORCE
	-$(MKDIR) -p $(libexecdir)
	$(INSTALL) $(INSTALLFLAGS) -m 755 in.xfingerd $(libexecdir)
