SRCS= main.c faxtotpc.c rp500.c
XSRCS=fax5version.c rpversion.c
FAX5OBJS = main.o faxtotpc.o
RPOBJS =  rp500.o faxtotpc.o
PROGRAMS= rp500 fax500


rp500 : rpversion.o
	$(CC) $(LDFLAGS) -o $@ $(RPOBJS) rpversion.o $(LIBS)

fax500 : fax5version.o
	$(CC) $(LDFLAGS) -o $@ $(RPOBJS) fax5version.o $(LIBS)

rpversion.c: ${RPOBJS} $(LDAP_LIBDEPEND)
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	    t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	    -e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	    -e "s|%VERSION%|$${v}|" \
	    < Versionrp.c > $@)

fax5version.c: ${FAX5OBJS} $(LDAP_LIBDEPEND)
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	    t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	    -e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	    -e "s|%VERSION%|$${v}|" \
	    < Version.c > $@)

install: $(PROGRAMS) xrpcomp FORCE
	-$(MKDIR) -p $(bindir) $(libexecdir)
	$(INSTALL) $(INSTALLFLAGS) -m 755 rp500 $(libexecdir)
	$(INSTALL) $(INSTALLFLAGS) -m 755 fax500 $(libexecdir)
	$(SED) -e 's%ETCDIR%$(libexecdir)%' xrpcomp > /tmp/xrpcomp.tmp
	$(INSTALL) $(INSTALLFLAGS) -m 755 /tmp/xrpcomp.tmp $(libexecdir)/xrpcomp
	$(RM) /tmp/xrpcomp.tmp
